<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sz91online.bgms.module.baby.dao.BabyTaskMapperExt">
	<resultMap
		extends="com.sz91online.bgms.module.baby.dao.BabyTaskMapper.BaseResultMap"
		id="simpleBabyTask" type="com.sz91online.bgms.module.baby.domain.SimpleBabyTask">
		<result column="baby_name" property="babyName" />
		<result column="baby_sex" property="babySex" />
		<result column="baby_age" property="babyAge" />
		<result column="pay_more" property="payMore" />
		<result column="fee_amount" property="feeAmount" />
		<result column="credit_code" property="creditCode"/>
		<result column="addr_name" property="addrName"/>
		<result column="tel" property="tel" />
		<result column="require_start_time" property="requireStartTime" />
		<result column="require_end_time" property="requireEndTime" />
		<result column="addr_name" property="addrName" />
		<result column="addr_pos_x" property="addrPosX" />
		<result column="addr_pos_y" property="addrPosY" />
	</resultMap>

	<select id="listTasks" resultMap="simpleBabyTask">

		SELECT
		task.*,req.baby_name,req.baby_sex,req.baby_age,req.start_time require_start_time, req.end_time require_end_time,
		req.credit_code, req.fee_amount,req.pay_more,req.addr_name,req.addr_pos_y,req.addr_pos_x,uinfo.tel FROM t_baby_tasks task
		INNER JOIN t_baby_require req ON task.require_code = req.require_code
		INNER JOIN t_baby_user_info uinfo ON uinfo.user_code = req.user_code
		where task.get_user_code = #{user_code,jdbcType=VARCHAR}
		<if test="start_time != null">
			and req.start_time &gt; #{start_time,jdbcType=TIMESTAMP}
		</if>
		<if test="end_time != null">
			and req.start_time &lt; #{end_time,jdbcType=TIMESTAMP}
		</if>
		<if test="status != null">
			and task.status = #{status,jdbcType=VARCHAR}
		</if>
	</select>

	<select id="listDoneTasks" resultMap="simpleBabyTask">

		SELECT
		task.*,req.baby_name,req.baby_sex,req.baby_age,req.start_time require_start_time, req.end_time require_end_time,
		req.credit_code, req.fee_amount,req.pay_more,req.addr_name,req.addr_pos_y,req.addr_pos_x,uinfo.tel FROM t_baby_tasks task
		INNER JOIN t_baby_require req ON task.require_code = req.require_code
		INNER JOIN t_baby_user_info uinfo ON uinfo.user_code = req.user_code
		where task.get_user_code = #{param1,jdbcType=VARCHAR}
		and	task.task_status = 'AF'
	</select>

	<select id="findSimpleTaskByRequireCode" resultMap="simpleBabyTask">

		SELECT
		task.*,req.baby_name,req.baby_sex,req.baby_age,req.start_time require_start_time, req.end_time require_end_time,
		req.credit_code, req.fee_amount,req.pay_more,req.addr_name,req.addr_pos_y,req.addr_pos_x,uinfo.tel FROM t_baby_tasks task
		INNER JOIN t_baby_require req ON task.require_code = req.require_code
		INNER JOIN t_baby_user_info uinfo ON uinfo.user_code = req.user_code
		where task.require_code = #{param1,jdbcType=VARCHAR}

	</select>

	<select id="findSimpleTaskByTaskCode" resultMap="simpleBabyTask">
		SELECT
		task.*,req.baby_name,req.baby_sex,req.baby_age,req.start_time require_start_time, req.end_time require_end_time,
		req.credit_code, req.fee_amount,req.pay_more,req.addr_name,req.addr_pos_y,req.addr_pos_x,uinfo.tel FROM t_baby_tasks task
		INNER JOIN t_baby_require req ON task.require_code = req.require_code
		INNER JOIN t_baby_user_info uinfo ON uinfo.user_code = req.user_code
		where task.task_code = #{param1,jdbcType=VARCHAR}

	</select>

	<update id="setTaskStatus">
		update t_baby_tasks set task_status = #{status,jdbcType=VARCHAR} where require_code = #{require_code,jdbcType=VARCHAR}
	</update>
</mapper>